{% extends "base.html" %}

{% block title %}í™˜ì ìƒì„¸ ì •ë³´ - GuGu Medical Center EMR{% endblock %}

{% block content %}
<div class="patient-container">

  <!-- ğŸ¥ ì™¼ìª½: ë°©ë¬¸ ê¸°ë¡ (ì‚¬ì´ë“œë°”) -->
  <div class="left-panel">
    <h3>ë°©ë¬¸ ê¸°ë¡</h3>
    {% for record in visit_records %}
    <a href="/patient_detail?name={{ name | urlencode }}&birth_date={{ birth_date | urlencode }}&visit_date={{ record.visit_date.strftime('%Y-%m-%d') }}"
      class="visit-button">
      {{ record.visit_date.strftime('%Y-%m-%d') }}
    </a>
    {% endfor %}
  </div>

  <!-- ğŸ“Œ ì˜¤ë¥¸ìª½: í™˜ì ì •ë³´ ë° ì°¨íŠ¸ -->
  <div class="main-content">
    
    <div class="patient-info">
      <h2>í™˜ì ì •ë³´</h2>
      <div class="info-row">
        <div><strong>ì´ë¦„:</strong> {{ name }}</div>
        <div><strong>ìƒë…„ì›”ì¼:</strong> {{ birth_date }}</div>
      </div>
    </div>

    <div class="content-panel">
      <div class="box chart">
        <h3>ìƒˆë¡œìš´ ì°¨íŠ¸ ì‘ì„±</h3>
        <form action="/patient_detail/new_emr" method="post">
          <input type="hidden" name="name" value="{{ name }}">
          <input type="hidden" name="birth_date" value="{{ birth_date }}">

          <div class="form-row">
            <label for="visit_date">ë°©ë¬¸ ë‚ ì§œ</label>
            <input type="date" id="visit_date" name="visit_date" required>
          </div>

          <div class="form-row">
            <label for="vitals">Vital Signs</label>
            <div class="vitals-group">
              <input type="number" step="1" name="vitals_bp" placeholder="í˜ˆì•• (mmHg)">
              <input type="number" step="1" name="vitals_hr" placeholder="ë§¥ë°• (bpm)">
            </div>
            <div class="vitals-group">
              <input type="number" step="1" name="vitals_glucose" placeholder="í˜ˆë‹¹ (mg/dL)">
              <input type="number" step="0.1" name="vitals_temp" placeholder="ì²´ì˜¨ (Â°C)">
            </div>
          </div>

          <div class="soap-section">
            <h4>Symptoms (ì¦ìƒ)</h4>
            <textarea name="symptoms" rows="3" placeholder="ì˜ˆ) í™˜ìì˜ í˜¸ì†Œ, í†µì¦ ì •ë„, í˜„ì¬ ìƒí™©" required></textarea>
          </div>
          <div class="soap-section">
            <h4>Signs (ì§•í›„)</h4>
            <textarea name="objective" rows="3" placeholder="ì˜ˆ) ê²€ì‚¬ì†Œê²¬, ê´€ì°°ëœ ì§•í›„"></textarea>
          </div>
          <div class="soap-section">
            <h4>Assessment (ì§„ë‹¨)</h4>
            <textarea name="assessment" rows="3" placeholder="ì˜ˆ) ì„ìƒì  íŒë‹¨, ê°ë³„ì§„ë‹¨ ë“±"></textarea>
          </div>
          <div class="soap-section">
            <h4>Plan (ì¹˜ë£Œ ê³„íš)</h4>
            <textarea name="treatment" rows="3" placeholder="ì˜ˆ) ì²˜ë°©ì•½, ì¶”í›„ ê³„íš, ì¶”ê°€ ê²€ì‚¬ ë“±" required></textarea>
          </div>

          <div class="button-group">
            <button type="submit" class="button">ì €ì¥</button>
            <button type="button" class="button" onclick="alert('ì§„ë£Œ ì™„ë£Œ ì²˜ë¦¬!')">ì§„ë£Œ ì™„ë£Œ</button>
          </div>
        </form>
      </div>

      <div class="box chart">
        <h3>ì§ì „ ê¸°ë¡</h3>
        {% if latest_record %}
        <p><strong>ë°©ë¬¸ë‚ ì§œ:</strong> {{ latest_record.visit_date.strftime('%Y-%m-%d') }}</p>
        <p><strong>ì£¼ê´€ì  ì¦ìƒ(S):</strong> {{ latest_record.symptoms }}</p>
        <p><strong>ì¹˜ë£Œ ê³„íš(P):</strong> {{ latest_record.treatment }}</p>
        {% else %}
        <p>ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        {% endif %}
      </div>
    </div>
  </div>

</div>
{% endblock %}
